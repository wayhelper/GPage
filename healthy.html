<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>低 GI 晚餐 + 运动一周计划（可打勾 · 可打印）</title>
    <link rel="stylesheet" href="./css/common.css"/>
    <script src="./js/common.js"></script>
    <link>
    <style>
        :root{--bg:#f7fafc;--card:#fff;--text:#0f172a;--muted:#64748b;--accent:#0ea5a4}
        [data-dark="true"]{--bg:#0b1220;--card:#071024;--text:#e6eef8;--muted:#93a5bf}
        *{box-sizing:border-box}
        body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans CJK SC',"Helvetica Neue",Arial;margin:0;background:var(--bg);color:var(--text);line-height:1.4}
        .container{max-width:1100px;margin:24px auto;padding:16px}
        header{display:flex;flex-wrap:wrap;align-items:end;justify-content:space-between;gap:12px}
        h1{margin:0;font-size:20px}
        p.sub{margin:4px 0 0;color:var(--muted);font-size:13px}
        .controls{display:flex;gap:8px}
        button,select{padding:8px 10px;border-radius:10px;border:1px solid rgba(15,23,42,0.08);background:var(--card);cursor:pointer}
        .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:12px;margin-top:16px}
        .card{background:var(--card);border-radius:12px;padding:12px;border:1px solid rgba(15,23,42,0.06)}
        .small{font-size:13px;color:var(--muted)}
        ul{padding-left:18px;margin:6px 0}
        label.item{display:flex;gap:8px;align-items:flex-start}
        input[type='checkbox']{width:18px;height:18px;margin-top:3px}
        textarea{width:100%;min-height:44px;border-radius:8px;padding:8px;border:1px solid rgba(15,23,42,0.06);background:transparent;color:var(--text)}
        .footer{margin-top:12px;font-size:13px;color:var(--muted)}
        .badge{display:inline-block;padding:6px 8px;border-radius:999px;border:1px solid rgba(15,23,42,0.06);background:linear-gradient(180deg,rgba(255,255,255,0.6),transparent);margin-left:8px}
        .muted{color:var(--muted)}
        @media print{.controls, .print-hide{display:none} body{background:white}}
    </style>
</head>
<body>
<div class="container" id="app">
    <header>
        <div>
            <h1>低 GI 晚餐 + 运动一周计划</h1>
            <p class="sub">目标：减少胰岛素分泌压力 · 提高胰岛素敏感性 · 规律作息</p>
        </div>

        <div class="controls print-hide">
            <select id="startDay"></select>
            <button id="toggleDark">深色/浅色</button>
            <button id="resetWeek">本周清零</button>
            <button id="printBtn">打印 / 保存为 PDF</button>
        </div>
    </header>

    <div class="grid" id="grid"></div>

    <div class="footer print-hide">
        <span class="small">提示：晚餐 7 分饱，饭后散步 15–20 分钟，保证充足睡眠。</span>
        <span class="badge" id="summary">完成度 0%</span>
    </div>
</div>

<script>
    // 数据
    const plan = {
        "周一": { dinner: ["糙米饭 半碗","清蒸三文鱼/鳕鱼","清炒西兰花","蒸南瓜"], workout: ["晚饭后 30–60 分钟快走/慢跑 40 分钟","拉伸 5–10 分钟"] },
        "周二": { dinner: ["小米粥 半碗（无糖）","去皮鸡胸肉 煎/烤","凉拌菠菜","西红柿鸡蛋汤"], workout: ["力量：深蹲、平板支撑、哑铃推举 各 3 组","拉伸 5–10 分钟"] },
        "周三": { dinner: ["玉米半根 / 红薯半个","牛肉炖蘑菇","炒丝瓜","黄瓜拌木耳"], workout: ["骑车/椭圆机 40 分钟","核心 10 分钟"] },
        "周四": { dinner: ["藜麦饭 半碗","虾仁炒蛋","清炒荷兰豆","紫甘蓝沙拉"], workout: ["力量：俯卧撑、弓步蹲、哑铃划船 各 3 组","拉伸 5–10 分钟"] },
        "周五": { dinner: ["荞麦面（小份，凉拌）","豆腐","鸡蛋羹","凉拌苦瓜","番茄黄瓜沙拉"], workout: ["快走 + 爬楼梯 30–40 分钟","放松拉伸"] },
        "周六": { dinner: ["燕麦粥 半碗（无糖）","烤鸡腿（去皮）","蒸菜花","清炒油麦菜"], workout: ["瑜伽/普拉提 45 分钟","呼吸放松 5 分钟"] },
        "周日": { dinner: ["红豆杂粮饭 半碗","清蒸鲈鱼","凉拌海带丝","冬瓜汤"], workout: ["轻松活动：游泳/远足/打球 30–60 分钟","睡前拉伸"] }
    };

    // localStorage key
    const LS_KEY = 'lowgi_week_plan_v1';
    const LS_START = 'lowgi_week_start_v1';
    const LS_DARK = 'lowgi_week_dark_v1';

    // 初始状态
    function initState(){
        const saved = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
        const state = {};
        for(const day of Object.keys(plan)){
            state[day] = saved[day] || { dinner: plan[day].dinner.map(()=>false), workout: plan[day].workout.map(()=>false), notes: '' };
        }
        return state;
    }

    let state = initState();
    let startDay = localStorage.getItem(LS_START) || Object.keys(plan)[0];
    let dark = localStorage.getItem(LS_DARK) === '1';

    // DOM
    const grid = document.getElementById('grid');
    const startSelect = document.getElementById('startDay');
    const toggleDark = document.getElementById('toggleDark');
    const resetBtn = document.getElementById('resetWeek');
    const printBtn = document.getElementById('printBtn');
    const summary = document.getElementById('summary');

    function save(){
        localStorage.setItem(LS_KEY, JSON.stringify(state));
        localStorage.setItem(LS_START, startDay);
        localStorage.setItem(LS_DARK, dark? '1':'0');
        updateSummary();
    }

    function updateSummary(){
        let dT=0,dD=0,wT=0,wD=0;
        Object.values(state).forEach(s=>{
            dT += s.dinner.length; wT += s.workout.length;
            dD += s.dinner.filter(Boolean).length; wD += s.workout.filter(Boolean).length;
        });
        const pct = Math.round(((dD+wD)/Math.max(1,(dT+wT)))*100);
        summary.textContent = `完成度 ${pct}% (${dD+wD}/${dT+wT})`;
    }

    function render(){
        document.documentElement.setAttribute('data-dark', dark? 'true':'false');
        // start select
        startSelect.innerHTML = '';
        const days = Object.keys(plan);
        days.forEach(d=>{
            const op = document.createElement('option'); op.value = d; op.textContent = d + ' 开始';
            if(d===startDay) op.selected = true;
            startSelect.appendChild(op);
        });

        // ordered days
        const idx = days.indexOf(startDay);
        const ordered = idx===-1 ? days : [...days.slice(idx), ...days.slice(0,idx)];

        grid.innerHTML = '';
        ordered.forEach(day=>{
            const card = document.createElement('div'); card.className = 'card';
            const h = document.createElement('div'); h.style.display='flex'; h.style.justifyContent='space-between';
            const title = document.createElement('strong'); title.textContent = day;
            const tag = document.createElement('span'); tag.className='small muted'; tag.textContent='晚餐 · 运动';
            h.appendChild(title); h.appendChild(tag); card.appendChild(h);

            const row = document.createElement('div'); row.style.display='grid'; row.style.gridTemplateColumns='1fr 1fr'; row.style.gap='8px'; row.style.marginTop='8px';

            // 晚餐
            const left = document.createElement('div');
            const lt = document.createElement('div'); lt.className='small'; lt.textContent='晚餐（低 GI · 优质蛋白 · 蔬菜优先）'; left.appendChild(lt);
            const ul = document.createElement('ul');
            plan[day].dinner.forEach((it,i)=>{
                const li = document.createElement('li');
                const lab = document.createElement('label'); lab.className='item';
                const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = !!state[day].dinner[i];
                cb.addEventListener('change', ()=>{ state[day].dinner[i] = cb.checked; save(); render(); });
                const span = document.createElement('span'); span.textContent = it; if(cb.checked) span.style.textDecoration='line-through';
                lab.appendChild(cb); lab.appendChild(span); li.appendChild(lab); ul.appendChild(li);
            });
            left.appendChild(ul);

            // 运动
            const right = document.createElement('div');
            const rt = document.createElement('div'); rt.className='small'; rt.textContent='运动（≥150 分钟/周 + 2–3 次力量）'; right.appendChild(rt);
            const ul2 = document.createElement('ul');
            plan[day].workout.forEach((it,i)=>{
                const li = document.createElement('li');
                const lab = document.createElement('label'); lab.className='item';
                const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = !!state[day].workout[i];
                cb.addEventListener('change', ()=>{ state[day].workout[i] = cb.checked; save(); render(); });
                const span = document.createElement('span'); span.textContent = it; if(cb.checked) span.style.textDecoration='line-through';
                lab.appendChild(cb); lab.appendChild(span); li.appendChild(lab); ul2.appendChild(li);
            });
            right.appendChild(ul2);

            row.appendChild(left); row.appendChild(right); card.appendChild(row);

            // notes
            const noteLabel = document.createElement('div'); noteLabel.className='small'; noteLabel.style.marginTop='8px'; noteLabel.textContent='备注（购物清单 / 替换食材 / 心情）';
            const ta = document.createElement('textarea'); ta.value = state[day].notes || '';
            ta.addEventListener('input', ()=>{ state[day].notes = ta.value; save(); });
            card.appendChild(noteLabel); card.appendChild(ta);

            grid.appendChild(card);
        });

        updateSummary();
    }

    // 事件
    startSelect.addEventListener('change', (e)=>{ startDay = e.target.value; save(); render(); });
    toggleDark.addEventListener('click', ()=>{ dark = !dark; save(); render(); });
    resetBtn.addEventListener('click', ()=>{
        if(confirm('确定要将本周所有勾选清零吗？')){
            Object.keys(state).forEach(d=>{ state[d].dinner = plan[d].dinner.map(()=>false); state[d].workout = plan[d].workout.map(()=>false); state[d].notes = ''; });
            save(); render();
        }
    });
    printBtn.addEventListener('click', ()=>window.print());

    // 初始化
    render();

    // 为用户方便：监听键盘 Ctrl+S 保存本地（只是触发 save 到 localStorage）
    window.addEventListener('keydown', (e)=>{
        if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='s'){
            e.preventDefault(); save(); msg('已保存到本地缓存（localStorage）');
        }
    });
</script>
</body>
</html>
